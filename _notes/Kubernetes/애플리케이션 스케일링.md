# **1. 스케일링이란?**
Replicaset과 Deployment를 활용하여 Pod의 수를 조절하는 방식

**Replicaset 생성 예시**
```cmd
kubectl apply -f https://raw.githubusercontent.com/gilbutITbook/kiamol/main/ch06/whoami/whoami.yaml
```

**whoami.yaml**
```yaml
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: whoami-web
  labels:
    kiamol: ch06
spec:
  replicas: 1
  selector:
    matchLabels:
      app: whoami-web
  template:
    metadata:
      labels:
        app: whoami-web
    spec:
      containers:
        - image: kiamol/ch02-whoami
          name: web
          ports:
            - containerPort: 80
              name: http
```

![[Pasted image 20231128184757.png]]
replicaset을 생성하고 deploy를 조회하였지만 deploy는 조회되지 않음   

# **2.Deployment로 부하 스케일링**

**loadbalancer와 deployment 생성**
```cmd
kubectl apply -f https://raw.githubusercontent.com/gilbutITbook/kiamol/main/ch06/pi/web/web-service.yaml -f https://raw.githubusercontent.com/gilbutITbook/kiamol/main/ch06/pi/web/web.yaml
```

**web.yaml**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: pi-web
  labels:
    kiamol: ch06
spec:
  replicas: 2
  selector:
    matchLabels:
      app: pi-web
  template:
    metadata:
      labels:
        app: pi-web
    spec:
      containers:
        - image: kiamol/ch05-pi
          command: ["dotnet", "Pi.Web.dll", "-m", "web"]
          name: web
          ports:
            - containerPort: 80
              name: http
```

**deployment와 replicaset의 관계도**
![[Pasted image 20231128201119.png]]

**결과**
![[Pasted image 20231128203330.png]]
## Replicas 변경
```yaml
kubectl apply -f https://raw.githubusercontent.com/gilbutITbook/kiamol/main/ch06/pi/web/update/web-replicas-3.yaml
```

**web-replicas-3.yaml**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: pi-web
  labels:
    kiamol: ch06
spec:
  replicas: 3
  selector:
    matchLabels:
      app: pi-web
  template:
    metadata:
      labels:
        app: pi-web
    spec:
      containers:
        - image: kiamol/ch05-pi
          command: ["dotnet", "Pi.Web.dll", "-m", "web"]
          name: web
          ports:
            - containerPort: 80
              name: http
```

![[Pasted image 20231128203404.png]]
## Pod 정의 변경
```yaml
kubectl apply -f https://raw.githubusercontent.com/gilbutITbook/kiamol/main/ch06/pi/web/update/web-logging-level.yaml
```

**web-logging-level.yaml**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: pi-web
  labels:
    kiamol: ch06
spec:
  replicas: 3
  selector:
    matchLabels:
      app: pi-web
  template:
    metadata:
      labels:
        app: pi-web
    spec:
      containers:
        - image: kiamol/ch05-pi
          command: ["dotnet", "Pi.Web.dll", "-m", "web"]
          name: web
          ports:
            - containerPort: 80
              name: http
          env:   # pod의 환경변수 변경
          - name: Logging__LogLevel__Default
            value: Debug
```

![[Pasted image 20231128203554.png]]
새로운 replicaset이 생성된 것을 확인   

## scale 명령 사용하기
```cmd
kubectl scale --replicas=4 deploy/pi-web
```
pi-web의 replicas를 4로 변경하는 명령어
